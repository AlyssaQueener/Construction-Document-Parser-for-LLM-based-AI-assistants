flowchart TD
    A["parse_gantt_chart_visual(path, 'full ai')"]
    A --> B["PDF to Image Conversion"]
    A --> C["PDF Processing â€” try table extraction"]

    %% â”€â”€ Left branch: image analysis â”€â”€
    B --> D["ðŸ¤– Mistral: Check timeline presence"]
    D --> E[/"timeline: True | False"/]

    %% â”€â”€ Right branch: table analysis â”€â”€
    C --> H[/"DataFrame"/]
    H --> I["Extract activities"]
    I --> J{"Activities available?"}

    %% â”€â”€ Path 1: Activities available â”€â”€
    J -->|"Yes"| K["ðŸ¤– Mistral: 'full ai w activities' Guided date extraction with known activity list for context Parameter: ðŸ“Œ timeline â†’ selects prompt variant"]
    K --> O[/"Parsed activities with dates"/]

    %% â”€â”€ Path 2 & 3: No activities â†’ check size â”€â”€
    J -->|"No"| F["Check image size"]
    F --> G{"to_be_chunked?"}

    %% â”€â”€ Path 2: Too large â†’ chunk â”€â”€
    G -->|"True"| L["Split PDF into image chunks Parameter: ðŸ“Œ timeline â†’ selects splitting strategy & prompt variant"]
    L --> M["ðŸ¤– Parse each chunk via Mistral, Aggregate results"]
    M --> O

    %% â”€â”€ Path 3: Small enough â†’ single call â”€â”€
    G -->|"False"| N["ðŸ¤– Mistral: 'full ai' - Unguided extraction Parameter: ðŸ“Œ timeline â†’ selects prompt variant"]
    N --> O

    %% â”€â”€ Styling â”€â”€
    classDef ai fill:#e8d5f5,stroke:#7c3aed,stroke-width:2px,color:#1e1e1e
    classDef decision fill:#fef3c7,stroke:#d97706,stroke-width:2px,color:#1e1e1e
    classDef data fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e1e1e
    classDef process fill:#f1f5f9,stroke:#475569,stroke-width:1px,color:#1e1e1e
    classDef output fill:#d1fae5,stroke:#059669,stroke-width:2px,color:#1e1e1e

    class D,K,M,N ai
    class G,J decision
    class E,H data
    class A,B,C,F,I,L process
    class O output